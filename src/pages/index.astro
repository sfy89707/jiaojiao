---
import { getCollection } from 'astro:content';
import FormattedDate from '../components/FormattedDate.astro';
import SiteLayout from '../layouts/SiteLayout.astro';
import { SITE_AUTHOR, SITE_BIO, SITE_DESCRIPTION, SITE_TITLE } from '../consts';

const BASE = import.meta.env.BASE_URL.endsWith('/') ? import.meta.env.BASE_URL : `${import.meta.env.BASE_URL}/`;

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const featured = posts.filter((p) => p.data.featured).slice(0, 2);
const latest = posts.slice(0, 8);
---

<SiteLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
	<section class="hero">
		<div class="hero-text">
			<div class="kicker">金渐层 · 个人博客</div>
			<h1>{SITE_AUTHOR}</h1>
			<p class="desc">{SITE_BIO}（喜欢睡觉和流口水）</p>
			<div class="actions">
				<a class="btn primary" href={`${BASE}blog`}>进入文章</a>
				<a class="btn ghost" href={`${BASE}about`}>关于我</a>
			</div>
		</div>
		<div class="hero-media">
			<img class="cat" src={`${BASE}images/jiaojiao-cutout.png?v=2`} alt="叫叫（金渐层）" loading="eager" />
		</div>
	</section>

	{featured.length > 0 && (
		<section class="section">
			<div class="section-title">置顶推荐</div>
			<div class="featured">
				{featured.map((p) => (
					<a class="fcard" href={`${BASE}blog/${p.id}/`}>
						<div class="ftitle">{p.data.title}</div>
						<div class="fmeta"><FormattedDate date={p.data.pubDate} /></div>
						<div class="fdesc">{p.data.description}</div>
					</a>
				))}
			</div>
		</section>
	)}

	<section class="section">
		<div class="section-title">最新文章</div>
		<div class="posts">
			{latest.map((p) => (
				<a class="post" href={`${BASE}blog/${p.id}/`}>
					<div class="title">{p.data.title}</div>
					<div class="meta">
						<FormattedDate date={p.data.pubDate} />
						{(p.data.tags ?? []).slice(0, 3).map((t) => (
							<span class="tag">{t}</span>
						))}
					</div>
					<div class="excerpt">{p.data.description}</div>
				</a>
			))}
		</div>
	</section>

	<style>
		.hero {
			background: linear-gradient(135deg, #0f172a 0%, #1e293b 60%, #0b1220 100%);
			border-radius: 18px;
			color: #fff;
			padding: 1.8rem 1.6rem;
			box-shadow: var(--box-shadow);
			display: grid;
			grid-template-columns: 1.2fr .8fr;
			gap: 1.2rem;
			align-items: center;
		}
		@media (max-width: 900px) {
			.hero { grid-template-columns: 1fr; }
			.hero-media { order: -1; }
		}
		.kicker { opacity: .75; font-size: .95rem; letter-spacing: .08em; text-transform: uppercase; }
		.hero h1 { margin: .4rem 0 .6rem; color: #fff; }
		.desc { margin: 0; opacity: .92; }
		.actions { margin-top: 1.2rem; display:flex; gap: .8rem; flex-wrap: wrap; }
		.btn { display:inline-block; padding: .62rem 1rem; border-radius: 10px; text-decoration:none; font-weight: 800; }
		.btn.primary { background: #38bdf8; color: #06283a; }
		.btn.ghost { background: rgba(255,255,255,.14); color: #fff; }

		.hero-media { display: grid; place-items: center; }
		.cat {
			width: min(360px, 92%);
			height: auto;
			max-height: 520px;
			object-fit: contain;
			border-radius: 18px;
			box-shadow: 0 18px 50px rgba(0,0,0,.35);
			border: 1px solid rgba(255,255,255,.18);
		}

		.section { margin-top: 1.4rem; }
		.section-title { font-weight: 900; margin-bottom: .8rem; }

		.featured { display:grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; }
		.fcard { background:#fff; border-radius:14px; box-shadow: var(--box-shadow); padding: 1rem; text-decoration:none; }
		.fcard:hover { transform: translateY(-1px); transition: .15s ease; }
		.ftitle { font-weight: 900; color: rgb(var(--black)); }
		.fmeta { margin-top: .35rem; color: rgb(var(--gray)); font-size: .92rem; }
		.fdesc { margin-top: .55rem; color: rgba(var(--gray-dark), .88); }

		.posts { display: grid; gap: .8rem; }
		.post {
			background: #fff;
			border-radius: 14px;
			box-shadow: var(--box-shadow);
			padding: 1rem;
			text-decoration: none;
		}
		.post:hover { transform: translateY(-1px); transition: .15s ease; }
		.post .title { font-weight: 900; color: rgb(var(--black)); }
		.meta { margin-top: .35rem; color: rgb(var(--gray)); font-size: .92rem; display:flex; gap:.45rem; flex-wrap: wrap; align-items: center; }
		.tag { padding: .12rem .5rem; border-radius: 999px; background: rgba(14,165,233,.10); color: var(--accent-dark); }
		.excerpt { margin-top: .55rem; color: rgba(var(--gray-dark), .88); }
	</style>
</SiteLayout>
