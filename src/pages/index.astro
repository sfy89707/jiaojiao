---
import { getCollection } from 'astro:content';
import FormattedDate from '../components/FormattedDate.astro';
import SiteLayout from '../layouts/SiteLayout.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';

const BASE = import.meta.env.BASE_URL.endsWith('/') ? import.meta.env.BASE_URL : `${import.meta.env.BASE_URL}/`;

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
const latest = posts.slice(0, 8);
---

<SiteLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
	<section class="hero">
		<div class="hero-inner">
			<div class="kicker">个人博客</div>
			<h1>jiaojiao</h1>
			<p class="desc">技术 / 工具 / 随笔。做一个可长期维护的知识库。</p>
			<div class="actions">
				<a class="btn primary" href={`${BASE}blog`}>进入文章</a>
				<a class="btn ghost" href={`${BASE}about`}>关于我</a>
			</div>
		</div>
	</section>

	<section class="section">
		<div class="section-title">最新文章</div>
		<div class="posts">
			{latest.map((p) => (
				<a class="post" href={`${BASE}blog/${p.id}/`}>
					<div class="title">{p.data.title}</div>
					<div class="meta">
						<FormattedDate date={p.data.pubDate} />
						{(p.data.tags ?? []).slice(0, 3).map((t) => (
							<span class="tag">{t}</span>
						))}
					</div>
					<div class="excerpt">{p.data.description}</div>
				</a>
			))}
		</div>
	</section>

	<style>
		.hero {
			background: linear-gradient(135deg, #0f172a 0%, #1e293b 60%, #0b1220 100%);
			border-radius: 18px;
			color: #fff;
			padding: 2.4rem 1.6rem;
			box-shadow: var(--box-shadow);
		}
		.kicker { opacity: .75; font-size: .95rem; letter-spacing: .08em; text-transform: uppercase; }
		.hero h1 { margin: .4rem 0 .6rem; color: #fff; }
		.desc { margin: 0; opacity: .92; }
		.actions { margin-top: 1.2rem; display:flex; gap: .8rem; flex-wrap: wrap; }
		.btn { display:inline-block; padding: .62rem 1rem; border-radius: 10px; text-decoration:none; font-weight: 700; }
		.btn.primary { background: #38bdf8; color: #06283a; }
		.btn.ghost { background: rgba(255,255,255,.14); color: #fff; }

		.section { margin-top: 1.4rem; }
		.section-title { font-weight: 900; margin-bottom: .8rem; }
		.posts { display: grid; gap: .8rem; }
		.post {
			background: #fff;
			border-radius: 14px;
			box-shadow: var(--box-shadow);
			padding: 1rem;
			text-decoration: none;
		}
		.post:hover { transform: translateY(-1px); transition: .15s ease; }
		.post .title { font-weight: 900; color: rgb(var(--black)); }
		.meta { margin-top: .35rem; color: rgb(var(--gray)); font-size: .92rem; display:flex; gap:.45rem; flex-wrap: wrap; align-items: center; }
		.tag { padding: .12rem .5rem; border-radius: 999px; background: rgba(14,165,233,.10); color: var(--accent-dark); }
		.excerpt { margin-top: .55rem; color: rgba(var(--gray-dark), .88); }
	</style>
</SiteLayout>
